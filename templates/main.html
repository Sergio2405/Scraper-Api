<!DOCTYPE html>
<html>
<head>
<title>Reporte</title>
<style>
    #dates{
	display:flex;
	flex-direction:column
    }

    #dates > div{
	border:1px solid black;
	background-color:grey;
    }
    form {
	display:grid;
	grid-template-rows: 90% 10%
    }
    body{
	margin-left:35%;
	margin-top:5%;
    }
</style>
</head>
<body>

<h1>Scrap SBS data by date</h1>
<p>Choose the dates you want</p>
<form style="width:500px;height:300px" onsubmit="submitFormReport(event)">
    <div>
	<input 
	    type="date" 
	    id="dateSelector" 
	    onchange="dates.innerHTML+=`<label>${event.target.value}<input name=${event.target.value} hidden value=${event.target.value}/></label>`" 
	/>
	<div id="dates"></div>
    </div>
    <button id="send">Send information</button>
</form>
<a href="../obtain" id="export">Export Excel File</a>
<script>
    function submitFormReport(e){
	e.preventDefault();
	const formData = new FormData(e.target);
	const formProps = Object.fromEntries(formData);

	const dates_list = Object.keys(formProps).map(date => date.split("-").reverse().join("/"));
	getReport(dates_list);
    }

    function getReport(dates){
	const options = {
	    method: 'POST',
	    headers: {
	    'Content-Type': 'application/json',
	    },
	    body: JSON.stringify(dates),
	};
	const export_tag = document.getElementById("export");
	const send_button = document.getElementById("send");

	send_button.disabled=true;
	export_tag.hidden=true;

	let interval = setTimeout(() => {
	    let timer = document.getElementById("timer");
	    timer.hidden=false;
	    timer.innerHTML += parseFloat(timer.innerHTML)+1;
	},1000);

	fetch('http://127.0.0.1:8001/generate', options).then(response => {
	    export_tag.hidden=false;
	    send_button.disabled=false;
	    })
    }
</script>
</body>
</html>
